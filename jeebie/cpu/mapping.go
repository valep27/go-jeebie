package cpu

import "github.com/valerio/go-jeebie/jeebie/util"

// Opcode represents a function that executes an opcode
type Opcode func(*CPU) int

// Decode retrieves the instruction identified by the value pointed at by the PC.
func Decode(c *CPU) Opcode {
	code := c.readImmediate()

	// 0xCB is only ever used as a prefix for the next byte.
	if code == 0xCB {
		code = c.readImmediate()
		c.currentOpcode = util.CombineBytes(code, 0xCB)
		return opcodeCBMap[uint8(code)]
	}

	c.currentOpcode = util.CombineBytes(code, 0)
	return opcodeMap[uint8(code)]
}

var opcodeMap = map[uint8]Opcode{
	0x00: opcode0x00,
	0x01: opcode0x01,
	0x02: opcode0x02,
	0x03: opcode0x03,
	0x04: opcode0x04,
	0x05: opcode0x05,
	0x06: opcode0x06,
	0x07: opcode0x07,
	0x08: opcode0x08,
	0x09: opcode0x09,
	0x0a: opcode0x0A,
	0x0b: opcode0x0B,
	0x0c: opcode0x0C,
	0x0d: opcode0x0D,
	0x0e: opcode0x0E,
	0x0f: opcode0x0F,
	0x10: opcode0x10,
	0x11: opcode0x11,
	0x12: opcode0x12,
	0x13: opcode0x13,
	0x14: opcode0x14,
	0x15: opcode0x15,
	0x16: opcode0x16,
	0x17: opcode0x17,
	0x18: opcode0x18,
	0x19: opcode0x19,
	0x1a: opcode0x1A,
	0x1b: opcode0x1B,
	0x1c: opcode0x1C,
	0x1d: opcode0x1D,
	0x1e: opcode0x1E,
	0x1f: opcode0x1F,
	0x20: opcode0x20,
	0x21: opcode0x21,
	0x22: opcode0x22,
	0x23: opcode0x23,
	0x24: opcode0x24,
	0x25: opcode0x25,
	0x26: opcode0x26,
	0x27: opcode0x27,
	0x28: opcode0x28,
	0x29: opcode0x29,
	0x2a: opcode0x2A,
	0x2b: opcode0x2B,
	0x2c: opcode0x2C,
	0x2d: opcode0x2D,
	0x2e: opcode0x2E,
	0x2f: opcode0x2F,
	0x30: opcode0x30,
	0x31: opcode0x31,
	0x32: opcode0x32,
	0x33: opcode0x33,
	0x34: opcode0x34,
	0x35: opcode0x35,
	0x36: opcode0x36,
	0x37: opcode0x37,
	0x38: opcode0x38,
	0x39: opcode0x39,
	0x3a: opcode0x3A,
	0x3b: opcode0x3B,
	0x3c: opcode0x3C,
	0x3d: opcode0x3D,
	0x3e: opcode0x3E,
	0x3f: opcode0x3F,
	0x40: opcode0x40,
	0x41: opcode0x41,
	0x42: opcode0x42,
	0x43: opcode0x43,
	0x44: opcode0x44,
	0x45: opcode0x45,
	0x46: opcode0x46,
	0x47: opcode0x47,
	0x48: opcode0x48,
	0x49: opcode0x49,
	0x4a: opcode0x4A,
	0x4b: opcode0x4B,
	0x4c: opcode0x4C,
	0x4d: opcode0x4D,
	0x4e: opcode0x4E,
	0x4f: opcode0x4F,
	0x50: opcode0x50,
	0x51: opcode0x51,
	0x52: opcode0x52,
	0x53: opcode0x53,
	0x54: opcode0x54,
	0x55: opcode0x55,
	0x56: opcode0x56,
	0x57: opcode0x57,
	0x58: opcode0x58,
	0x59: opcode0x59,
	0x5a: opcode0x5A,
	0x5b: opcode0x5B,
	0x5c: opcode0x5C,
	0x5d: opcode0x5D,
	0x5e: opcode0x5E,
	0x5f: opcode0x5F,
	0x60: opcode0x60,
	0x61: opcode0x61,
	0x62: opcode0x62,
	0x63: opcode0x63,
	0x64: opcode0x64,
	0x65: opcode0x65,
	0x66: opcode0x66,
	0x67: opcode0x67,
	0x68: opcode0x68,
	0x69: opcode0x69,
	0x6a: opcode0x6A,
	0x6b: opcode0x6B,
	0x6c: opcode0x6C,
	0x6d: opcode0x6D,
	0x6e: opcode0x6E,
	0x6f: opcode0x6F,
	0x70: opcode0x70,
	0x71: opcode0x71,
	0x72: opcode0x72,
	0x73: opcode0x73,
	0x74: opcode0x74,
	0x75: opcode0x75,
	0x76: opcode0x76,
	0x77: opcode0x77,
	0x78: opcode0x78,
	0x79: opcode0x79,
	0x7a: opcode0x7A,
	0x7b: opcode0x7B,
	0x7c: opcode0x7C,
	0x7d: opcode0x7D,
	0x7e: opcode0x7E,
	0x7f: opcode0x7F,
	0x80: opcode0x80,
	0x81: opcode0x81,
	0x82: opcode0x82,
	0x83: opcode0x83,
	0x84: opcode0x84,
	0x85: opcode0x85,
	0x86: opcode0x86,
	0x87: opcode0x87,
	0x88: opcode0x88,
	0x89: opcode0x89,
	0x8a: opcode0x8A,
	0x8b: opcode0x8B,
	0x8c: opcode0x8C,
	0x8d: opcode0x8D,
	0x8e: opcode0x8E,
	0x8f: opcode0x8F,
	0x90: opcode0x90,
	0x91: opcode0x91,
	0x92: opcode0x92,
	0x93: opcode0x93,
	0x94: opcode0x94,
	0x95: opcode0x95,
	0x96: opcode0x96,
	0x97: opcode0x97,
	0x98: opcode0x98,
	0x99: opcode0x99,
	0x9a: opcode0x9A,
	0x9b: opcode0x9B,
	0x9c: opcode0x9C,
	0x9d: opcode0x9D,
	0x9e: opcode0x9E,
	0x9f: opcode0x9F,
	0xa0: opcode0xA0,
	0xa1: opcode0xA1,
	0xa2: opcode0xA2,
	0xa3: opcode0xA3,
	0xa4: opcode0xA4,
	0xa5: opcode0xA5,
	0xa6: opcode0xA6,
	0xa7: opcode0xA7,
	0xa8: opcode0xA8,
	0xa9: opcode0xA9,
	0xaa: opcode0xAA,
	0xab: opcode0xAB,
	0xac: opcode0xAC,
	0xad: opcode0xAD,
	0xae: opcode0xAE,
	0xaf: opcode0xAF,
	0xb0: opcode0xB0,
	0xb1: opcode0xB1,
	0xb2: opcode0xB2,
	0xb3: opcode0xB3,
	0xb4: opcode0xB4,
	0xb5: opcode0xB5,
	0xb6: opcode0xB6,
	0xb7: opcode0xB7,
	0xb8: opcode0xB8,
	0xb9: opcode0xB9,
	0xba: opcode0xBA,
	0xbb: opcode0xBB,
	0xbc: opcode0xBC,
	0xbd: opcode0xBD,
	0xbe: opcode0xBE,
	0xbf: opcode0xBF,
	0xc0: opcode0xC0,
	0xc1: opcode0xC1,
	0xc2: opcode0xC2,
	0xc3: opcode0xC3,
	0xc4: opcode0xC4,
	0xc5: opcode0xC5,
	0xc6: opcode0xC6,
	0xc7: opcode0xC7,
	0xc8: opcode0xC8,
	0xc9: opcode0xC9,
	0xca: opcode0xCA,
	0xcb: opcode0xCB,
	0xcc: opcode0xCC,
	0xcd: opcode0xCD,
	0xce: opcode0xCE,
	0xcf: opcode0xCF,
	0xd0: opcode0xD0,
	0xd1: opcode0xD1,
	0xd2: opcode0xD2,
	0xd3: opcode0xD3,
	0xd4: opcode0xD4,
	0xd5: opcode0xD5,
	0xd6: opcode0xD6,
	0xd7: opcode0xD7,
	0xd8: opcode0xD8,
	0xd9: opcode0xD9,
	0xda: opcode0xDA,
	0xdb: opcode0xDB,
	0xdc: opcode0xDC,
	0xdd: opcode0xDD,
	0xde: opcode0xDE,
	0xdf: opcode0xDF,
	0xe0: opcode0xE0,
	0xe1: opcode0xE1,
	0xe2: opcode0xE2,
	0xe3: opcode0xE3,
	0xe4: opcode0xE4,
	0xe5: opcode0xE5,
	0xe6: opcode0xE6,
	0xe7: opcode0xE7,
	0xe8: opcode0xE8,
	0xe9: opcode0xE9,
	0xea: opcode0xEA,
	0xeb: opcode0xEB,
	0xec: opcode0xEC,
	0xed: opcode0xED,
	0xee: opcode0xEE,
	0xef: opcode0xEF,
	0xf0: opcode0xF0,
	0xf1: opcode0xF1,
	0xf2: opcode0xF2,
	0xf3: opcode0xF3,
	0xf4: opcode0xF4,
	0xf5: opcode0xF5,
	0xf6: opcode0xF6,
	0xf7: opcode0xF7,
	0xf8: opcode0xF8,
	0xf9: opcode0xF9,
	0xfa: opcode0xFA,
	0xfb: opcode0xFB,
	0xfc: opcode0xFC,
	0xfd: opcode0xFD,
	0xfe: opcode0xFE,
	0xff: opcode0xFF,
}

var opcodeCBMap = map[uint8]Opcode{
	0x00: opcode0xCB00,
	0x01: opcode0xCB01,
	0x02: opcode0xCB02,
	0x03: opcode0xCB03,
	0x04: opcode0xCB04,
	0x05: opcode0xCB05,
	0x06: opcode0xCB06,
	0x07: opcode0xCB07,
	0x08: opcode0xCB08,
	0x09: opcode0xCB09,
	0x0a: opcode0xCB0A,
	0x0b: opcode0xCB0B,
	0x0c: opcode0xCB0C,
	0x0d: opcode0xCB0D,
	0x0e: opcode0xCB0E,
	0x0f: opcode0xCB0F,
	0x10: opcode0xCB10,
	0x11: opcode0xCB11,
	0x12: opcode0xCB12,
	0x13: opcode0xCB13,
	0x14: opcode0xCB14,
	0x15: opcode0xCB15,
	0x16: opcode0xCB16,
	0x17: opcode0xCB17,
	0x18: opcode0xCB18,
	0x19: opcode0xCB19,
	0x1a: opcode0xCB1A,
	0x1b: opcode0xCB1B,
	0x1c: opcode0xCB1C,
	0x1d: opcode0xCB1D,
	0x1e: opcode0xCB1E,
	0x1f: opcode0xCB1F,
	0x20: opcode0xCB20,
	0x21: opcode0xCB21,
	0x22: opcode0xCB22,
	0x23: opcode0xCB23,
	0x24: opcode0xCB24,
	0x25: opcode0xCB25,
	0x26: opcode0xCB26,
	0x27: opcode0xCB27,
	0x28: opcode0xCB28,
	0x29: opcode0xCB29,
	0x2a: opcode0xCB2A,
	0x2b: opcode0xCB2B,
	0x2c: opcode0xCB2C,
	0x2d: opcode0xCB2D,
	0x2e: opcode0xCB2E,
	0x2f: opcode0xCB2F,
	0x30: opcode0xCB30,
	0x31: opcode0xCB31,
	0x32: opcode0xCB32,
	0x33: opcode0xCB33,
	0x34: opcode0xCB34,
	0x35: opcode0xCB35,
	0x36: opcode0xCB36,
	0x37: opcode0xCB37,
	0x38: opcode0xCB38,
	0x39: opcode0xCB39,
	0x3a: opcode0xCB3A,
	0x3b: opcode0xCB3B,
	0x3c: opcode0xCB3C,
	0x3d: opcode0xCB3D,
	0x3e: opcode0xCB3E,
	0x3f: opcode0xCB3F,
	0x40: opcode0xCB40,
	0x41: opcode0xCB41,
	0x42: opcode0xCB42,
	0x43: opcode0xCB43,
	0x44: opcode0xCB44,
	0x45: opcode0xCB45,
	0x46: opcode0xCB46,
	0x47: opcode0xCB47,
	0x48: opcode0xCB48,
	0x49: opcode0xCB49,
	0x4a: opcode0xCB4A,
	0x4b: opcode0xCB4B,
	0x4c: opcode0xCB4C,
	0x4d: opcode0xCB4D,
	0x4e: opcode0xCB4E,
	0x4f: opcode0xCB4F,
	0x50: opcode0xCB50,
	0x51: opcode0xCB51,
	0x52: opcode0xCB52,
	0x53: opcode0xCB53,
	0x54: opcode0xCB54,
	0x55: opcode0xCB55,
	0x56: opcode0xCB56,
	0x57: opcode0xCB57,
	0x58: opcode0xCB58,
	0x59: opcode0xCB59,
	0x5a: opcode0xCB5A,
	0x5b: opcode0xCB5B,
	0x5c: opcode0xCB5C,
	0x5d: opcode0xCB5D,
	0x5e: opcode0xCB5E,
	0x5f: opcode0xCB5F,
	0x60: opcode0xCB60,
	0x61: opcode0xCB61,
	0x62: opcode0xCB62,
	0x63: opcode0xCB63,
	0x64: opcode0xCB64,
	0x65: opcode0xCB65,
	0x66: opcode0xCB66,
	0x67: opcode0xCB67,
	0x68: opcode0xCB68,
	0x69: opcode0xCB69,
	0x6a: opcode0xCB6A,
	0x6b: opcode0xCB6B,
	0x6c: opcode0xCB6C,
	0x6d: opcode0xCB6D,
	0x6e: opcode0xCB6E,
	0x6f: opcode0xCB6F,
	0x70: opcode0xCB70,
	0x71: opcode0xCB71,
	0x72: opcode0xCB72,
	0x73: opcode0xCB73,
	0x74: opcode0xCB74,
	0x75: opcode0xCB75,
	0x76: opcode0xCB76,
	0x77: opcode0xCB77,
	0x78: opcode0xCB78,
	0x79: opcode0xCB79,
	0x7a: opcode0xCB7A,
	0x7b: opcode0xCB7B,
	0x7c: opcode0xCB7C,
	0x7d: opcode0xCB7D,
	0x7e: opcode0xCB7E,
	0x7f: opcode0xCB7F,
	0x80: opcode0xCB80,
	0x81: opcode0xCB81,
	0x82: opcode0xCB82,
	0x83: opcode0xCB83,
	0x84: opcode0xCB84,
	0x85: opcode0xCB85,
	0x86: opcode0xCB86,
	0x87: opcode0xCB87,
	0x88: opcode0xCB88,
	0x89: opcode0xCB89,
	0x8a: opcode0xCB8A,
	0x8b: opcode0xCB8B,
	0x8c: opcode0xCB8C,
	0x8d: opcode0xCB8D,
	0x8e: opcode0xCB8E,
	0x8f: opcode0xCB8F,
	0x90: opcode0xCB90,
	0x91: opcode0xCB91,
	0x92: opcode0xCB92,
	0x93: opcode0xCB93,
	0x94: opcode0xCB94,
	0x95: opcode0xCB95,
	0x96: opcode0xCB96,
	0x97: opcode0xCB97,
	0x98: opcode0xCB98,
	0x99: opcode0xCB99,
	0x9a: opcode0xCB9A,
	0x9b: opcode0xCB9B,
	0x9c: opcode0xCB9C,
	0x9d: opcode0xCB9D,
	0x9e: opcode0xCB9E,
	0x9f: opcode0xCB9F,
	0xa0: opcode0xCBA0,
	0xa1: opcode0xCBA1,
	0xa2: opcode0xCBA2,
	0xa3: opcode0xCBA3,
	0xa4: opcode0xCBA4,
	0xa5: opcode0xCBA5,
	0xa6: opcode0xCBA6,
	0xa7: opcode0xCBA7,
	0xa8: opcode0xCBA8,
	0xa9: opcode0xCBA9,
	0xaa: opcode0xCBAA,
	0xab: opcode0xCBAB,
	0xac: opcode0xCBAC,
	0xad: opcode0xCBAD,
	0xae: opcode0xCBAE,
	0xaf: opcode0xCBAF,
	0xb0: opcode0xCBB0,
	0xb1: opcode0xCBB1,
	0xb2: opcode0xCBB2,
	0xb3: opcode0xCBB3,
	0xb4: opcode0xCBB4,
	0xb5: opcode0xCBB5,
	0xb6: opcode0xCBB6,
	0xb7: opcode0xCBB7,
	0xb8: opcode0xCBB8,
	0xb9: opcode0xCBB9,
	0xba: opcode0xCBBA,
	0xbb: opcode0xCBBB,
	0xbc: opcode0xCBBC,
	0xbd: opcode0xCBBD,
	0xbe: opcode0xCBBE,
	0xbf: opcode0xCBBF,
	0xc0: opcode0xCBC0,
	0xc1: opcode0xCBC1,
	0xc2: opcode0xCBC2,
	0xc3: opcode0xCBC3,
	0xc4: opcode0xCBC4,
	0xc5: opcode0xCBC5,
	0xc6: opcode0xCBC6,
	0xc7: opcode0xCBC7,
	0xc8: opcode0xCBC8,
	0xc9: opcode0xCBC9,
	0xca: opcode0xCBCA,
	0xcb: opcode0xCBCB,
	0xcc: opcode0xCBCC,
	0xcd: opcode0xCBCD,
	0xce: opcode0xCBCE,
	0xcf: opcode0xCBCF,
	0xd0: opcode0xCBD0,
	0xd1: opcode0xCBD1,
	0xd2: opcode0xCBD2,
	0xd3: opcode0xCBD3,
	0xd4: opcode0xCBD4,
	0xd5: opcode0xCBD5,
	0xd6: opcode0xCBD6,
	0xd7: opcode0xCBD7,
	0xd8: opcode0xCBD8,
	0xd9: opcode0xCBD9,
	0xda: opcode0xCBDA,
	0xdb: opcode0xCBDB,
	0xdc: opcode0xCBDC,
	0xdd: opcode0xCBDD,
	0xde: opcode0xCBDE,
	0xdf: opcode0xCBDF,
	0xe0: opcode0xCBE0,
	0xe1: opcode0xCBE1,
	0xe2: opcode0xCBE2,
	0xe3: opcode0xCBE3,
	0xe4: opcode0xCBE4,
	0xe5: opcode0xCBE5,
	0xe6: opcode0xCBE6,
	0xe7: opcode0xCBE7,
	0xe8: opcode0xCBE8,
	0xe9: opcode0xCBE9,
	0xea: opcode0xCBEA,
	0xeb: opcode0xCBEB,
	0xec: opcode0xCBEC,
	0xed: opcode0xCBED,
	0xee: opcode0xCBEE,
	0xef: opcode0xCBEF,
	0xf0: opcode0xCBF0,
	0xf1: opcode0xCBF1,
	0xf2: opcode0xCBF2,
	0xf3: opcode0xCBF3,
	0xf4: opcode0xCBF4,
	0xf5: opcode0xCBF5,
	0xf6: opcode0xCBF6,
	0xf7: opcode0xCBF7,
	0xf8: opcode0xCBF8,
	0xf9: opcode0xCBF9,
	0xfa: opcode0xCBFA,
	0xfb: opcode0xCBFB,
	0xfc: opcode0xCBFC,
	0xfd: opcode0xCBFD,
	0xfe: opcode0xCBFE,
	0xff: opcode0xCBFF,
}
