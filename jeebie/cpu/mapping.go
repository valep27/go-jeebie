package cpu

import "github.com/valerio/go-jeebie/jeebie/util"

// Opcode represents a function that executes an opcode
type Opcode func(*CPU) int

// Decode retrieves the instruction identified by the value pointed at by the PC.
func Decode(c *CPU) Opcode {
	code := c.readImmediate()

	// 0xCB is only ever used as a prefix for the next byte.
	if code == 0xCB {
		code = c.readImmediate()
		c.currentOpcode = util.CombineBytes(code, 0xCB)
		return opcodesCB[code]
	}

	c.currentOpcode = util.CombineBytes(code, 0)
	return opcodes[code]
}

var opcodes = [...]Opcode{
	opcode0x00, opcode0x01, opcode0x02, opcode0x03, opcode0x04, opcode0x05, opcode0x06, opcode0x07, opcode0x08, opcode0x09, opcode0x0A, opcode0x0B, opcode0x0C, opcode0x0D, opcode0x0E, opcode0x0F,
	opcode0x10, opcode0x11, opcode0x12, opcode0x13, opcode0x14, opcode0x15, opcode0x16, opcode0x17, opcode0x18, opcode0x19, opcode0x1A, opcode0x1B, opcode0x1C, opcode0x1D, opcode0x1E, opcode0x1F,
	opcode0x20, opcode0x21, opcode0x22, opcode0x23, opcode0x24, opcode0x25, opcode0x26, opcode0x27, opcode0x28, opcode0x29, opcode0x2A, opcode0x2B, opcode0x2C, opcode0x2D, opcode0x2E, opcode0x2F,
	opcode0x30, opcode0x31, opcode0x32, opcode0x33, opcode0x34, opcode0x35, opcode0x36, opcode0x37, opcode0x38, opcode0x39, opcode0x3A, opcode0x3B, opcode0x3C, opcode0x3D, opcode0x3E, opcode0x3F,
	opcode0x40, opcode0x41, opcode0x42, opcode0x43, opcode0x44, opcode0x45, opcode0x46, opcode0x47, opcode0x48, opcode0x49, opcode0x4A, opcode0x4B, opcode0x4C, opcode0x4D, opcode0x4E, opcode0x4F,
	opcode0x50, opcode0x51, opcode0x52, opcode0x53, opcode0x54, opcode0x55, opcode0x56, opcode0x57, opcode0x58, opcode0x59, opcode0x5A, opcode0x5B, opcode0x5C, opcode0x5D, opcode0x5E, opcode0x5F,
	opcode0x60, opcode0x61, opcode0x62, opcode0x63, opcode0x64, opcode0x65, opcode0x66, opcode0x67, opcode0x68, opcode0x69, opcode0x6A, opcode0x6B, opcode0x6C, opcode0x6D, opcode0x6E, opcode0x6F,
	opcode0x70, opcode0x71, opcode0x72, opcode0x73, opcode0x74, opcode0x75, opcode0x76, opcode0x77, opcode0x78, opcode0x79, opcode0x7A, opcode0x7B, opcode0x7C, opcode0x7D, opcode0x7E, opcode0x7F,
	opcode0x80, opcode0x81, opcode0x82, opcode0x83, opcode0x84, opcode0x85, opcode0x86, opcode0x87, opcode0x88, opcode0x89, opcode0x8A, opcode0x8B, opcode0x8C, opcode0x8D, opcode0x8E, opcode0x8F,
	opcode0x90, opcode0x91, opcode0x92, opcode0x93, opcode0x94, opcode0x95, opcode0x96, opcode0x97, opcode0x98, opcode0x99, opcode0x9A, opcode0x9B, opcode0x9C, opcode0x9D, opcode0x9E, opcode0x9F,
	opcode0xA0, opcode0xA1, opcode0xA2, opcode0xA3, opcode0xA4, opcode0xA5, opcode0xA6, opcode0xA7, opcode0xA8, opcode0xA9, opcode0xAA, opcode0xAB, opcode0xAC, opcode0xAD, opcode0xAE, opcode0xAF,
	opcode0xB0, opcode0xB1, opcode0xB2, opcode0xB3, opcode0xB4, opcode0xB5, opcode0xB6, opcode0xB7, opcode0xB8, opcode0xB9, opcode0xBA, opcode0xBB, opcode0xBC, opcode0xBD, opcode0xBE, opcode0xBF,
	opcode0xC0, opcode0xC1, opcode0xC2, opcode0xC3, opcode0xC4, opcode0xC5, opcode0xC6, opcode0xC7, opcode0xC8, opcode0xC9, opcode0xCA, opcode0xCB, opcode0xCC, opcode0xCD, opcode0xCE, opcode0xCF,
	opcode0xD0, opcode0xD1, opcode0xD2, opcode0xD3, opcode0xD4, opcode0xD5, opcode0xD6, opcode0xD7, opcode0xD8, opcode0xD9, opcode0xDA, opcode0xDB, opcode0xDC, opcode0xDD, opcode0xDE, opcode0xDF,
	opcode0xE0, opcode0xE1, opcode0xE2, opcode0xE3, opcode0xE4, opcode0xE5, opcode0xE6, opcode0xE7, opcode0xE8, opcode0xE9, opcode0xEA, opcode0xEB, opcode0xEC, opcode0xED, opcode0xEE, opcode0xEF,
	opcode0xF0, opcode0xF1, opcode0xF2, opcode0xF3, opcode0xF4, opcode0xF5, opcode0xF6, opcode0xF7, opcode0xF8, opcode0xF9, opcode0xFA, opcode0xFB, opcode0xFC, opcode0xFD, opcode0xFE, opcode0xFF,
}

var opcodesCB = [...]Opcode{
	opcode0xCB00, opcode0xCB01, opcode0xCB02, opcode0xCB03, opcode0xCB04, opcode0xCB05, opcode0xCB06, opcode0xCB07, opcode0xCB08, opcode0xCB09, opcode0xCB0A, opcode0xCB0B, opcode0xCB0C, opcode0xCB0D, opcode0xCB0E, opcode0xCB0F,
	opcode0xCB10, opcode0xCB11, opcode0xCB12, opcode0xCB13, opcode0xCB14, opcode0xCB15, opcode0xCB16, opcode0xCB17, opcode0xCB18, opcode0xCB19, opcode0xCB1A, opcode0xCB1B, opcode0xCB1C, opcode0xCB1D, opcode0xCB1E, opcode0xCB1F,
	opcode0xCB20, opcode0xCB21, opcode0xCB22, opcode0xCB23, opcode0xCB24, opcode0xCB25, opcode0xCB26, opcode0xCB27, opcode0xCB28, opcode0xCB29, opcode0xCB2A, opcode0xCB2B, opcode0xCB2C, opcode0xCB2D, opcode0xCB2E, opcode0xCB2F,
	opcode0xCB30, opcode0xCB31, opcode0xCB32, opcode0xCB33, opcode0xCB34, opcode0xCB35, opcode0xCB36, opcode0xCB37, opcode0xCB38, opcode0xCB39, opcode0xCB3A, opcode0xCB3B, opcode0xCB3C, opcode0xCB3D, opcode0xCB3E, opcode0xCB3F,
	opcode0xCB40, opcode0xCB41, opcode0xCB42, opcode0xCB43, opcode0xCB44, opcode0xCB45, opcode0xCB46, opcode0xCB47, opcode0xCB48, opcode0xCB49, opcode0xCB4A, opcode0xCB4B, opcode0xCB4C, opcode0xCB4D, opcode0xCB4E, opcode0xCB4F,
	opcode0xCB50, opcode0xCB51, opcode0xCB52, opcode0xCB53, opcode0xCB54, opcode0xCB55, opcode0xCB56, opcode0xCB57, opcode0xCB58, opcode0xCB59, opcode0xCB5A, opcode0xCB5B, opcode0xCB5C, opcode0xCB5D, opcode0xCB5E, opcode0xCB5F,
	opcode0xCB60, opcode0xCB61, opcode0xCB62, opcode0xCB63, opcode0xCB64, opcode0xCB65, opcode0xCB66, opcode0xCB67, opcode0xCB68, opcode0xCB69, opcode0xCB6A, opcode0xCB6B, opcode0xCB6C, opcode0xCB6D, opcode0xCB6E, opcode0xCB6F,
	opcode0xCB70, opcode0xCB71, opcode0xCB72, opcode0xCB73, opcode0xCB74, opcode0xCB75, opcode0xCB76, opcode0xCB77, opcode0xCB78, opcode0xCB79, opcode0xCB7A, opcode0xCB7B, opcode0xCB7C, opcode0xCB7D, opcode0xCB7E, opcode0xCB7F,
	opcode0xCB80, opcode0xCB81, opcode0xCB82, opcode0xCB83, opcode0xCB84, opcode0xCB85, opcode0xCB86, opcode0xCB87, opcode0xCB88, opcode0xCB89, opcode0xCB8A, opcode0xCB8B, opcode0xCB8C, opcode0xCB8D, opcode0xCB8E, opcode0xCB8F,
	opcode0xCB90, opcode0xCB91, opcode0xCB92, opcode0xCB93, opcode0xCB94, opcode0xCB95, opcode0xCB96, opcode0xCB97, opcode0xCB98, opcode0xCB99, opcode0xCB9A, opcode0xCB9B, opcode0xCB9C, opcode0xCB9D, opcode0xCB9E, opcode0xCB9F,
	opcode0xCBA0, opcode0xCBA1, opcode0xCBA2, opcode0xCBA3, opcode0xCBA4, opcode0xCBA5, opcode0xCBA6, opcode0xCBA7, opcode0xCBA8, opcode0xCBA9, opcode0xCBAA, opcode0xCBAB, opcode0xCBAC, opcode0xCBAD, opcode0xCBAE, opcode0xCBAF,
	opcode0xCBB0, opcode0xCBB1, opcode0xCBB2, opcode0xCBB3, opcode0xCBB4, opcode0xCBB5, opcode0xCBB6, opcode0xCBB7, opcode0xCBB8, opcode0xCBB9, opcode0xCBBA, opcode0xCBBB, opcode0xCBBC, opcode0xCBBD, opcode0xCBBE, opcode0xCBBF,
	opcode0xCBC0, opcode0xCBC1, opcode0xCBC2, opcode0xCBC3, opcode0xCBC4, opcode0xCBC5, opcode0xCBC6, opcode0xCBC7, opcode0xCBC8, opcode0xCBC9, opcode0xCBCA, opcode0xCBCB, opcode0xCBCC, opcode0xCBCD, opcode0xCBCE, opcode0xCBCF,
	opcode0xCBD0, opcode0xCBD1, opcode0xCBD2, opcode0xCBD3, opcode0xCBD4, opcode0xCBD5, opcode0xCBD6, opcode0xCBD7, opcode0xCBD8, opcode0xCBD9, opcode0xCBDA, opcode0xCBDB, opcode0xCBDC, opcode0xCBDD, opcode0xCBDE, opcode0xCBDF,
	opcode0xCBE0, opcode0xCBE1, opcode0xCBE2, opcode0xCBE3, opcode0xCBE4, opcode0xCBE5, opcode0xCBE6, opcode0xCBE7, opcode0xCBE8, opcode0xCBE9, opcode0xCBEA, opcode0xCBEB, opcode0xCBEC, opcode0xCBED, opcode0xCBEE, opcode0xCBEF,
	opcode0xCBF0, opcode0xCBF1, opcode0xCBF2, opcode0xCBF3, opcode0xCBF4, opcode0xCBF5, opcode0xCBF6, opcode0xCBF7, opcode0xCBF8, opcode0xCBF9, opcode0xCBFA, opcode0xCBFB, opcode0xCBFC, opcode0xCBFD, opcode0xCBFE, opcode0xCBFF,
}
